

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>calculations_atom_single &mdash; ARC - Alkali Rydberg Calculator 0.9 beta documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/arc_logo.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ARC - Alkali Rydberg Calculator 0.9 beta documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ARC - Alkali Rydberg Calculator
          

          
            
            <img src="../_static/logo_small.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started with ARC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detailed_doc.html">Detailed documentation of functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">How to contribute to the project</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ARC - Alkali Rydberg Calculator</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>calculations_atom_single</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for calculations_atom_single</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module provides calculations of single-atom properties.</span>
<span class="sd">    </span>
<span class="sd">    Included calculations are Stark maps, level plot visualisations, </span>
<span class="sd">    lifetimes and radiative decays.</span>
<span class="sd">    </span>
<span class="sd"> </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Detailed documentation</span>
<span class="sd">    ----------------------</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">exp</span><span class="p">,</span><span class="n">log</span><span class="p">,</span><span class="n">sqrt</span>
<span class="c1">#from pylab import *</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="c1">#from algebra_nikola import *</span>
<span class="kn">from</span> <span class="nn">wigner</span> <span class="k">import</span> <span class="n">Wigner6j</span><span class="p">,</span><span class="n">Wigner3j</span><span class="p">,</span><span class="n">CG</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="k">import</span> <span class="n">physical_constants</span><span class="p">,</span><span class="n">pi</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">epsilon_0</span><span class="p">,</span><span class="n">hbar</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="k">import</span> <span class="n">e</span> <span class="k">as</span> <span class="n">elemCharge</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">curve_fit</span>

<span class="c1"># for matrices</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">zeros</span><span class="p">,</span><span class="n">savetxt</span><span class="p">,</span> <span class="n">complex64</span><span class="p">,</span><span class="n">complex128</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="k">import</span> <span class="n">eigvalsh</span><span class="p">,</span><span class="n">eig</span><span class="p">,</span><span class="n">eigh</span>
<span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="k">import</span> <span class="n">conjugate</span>
<span class="kn">from</span> <span class="nn">numpy.lib.polynomial</span> <span class="k">import</span> <span class="n">real</span>

<span class="c1">#from wigner_rotation import wignerD</span>

<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="k">import</span> <span class="n">lil_matrix</span><span class="p">,</span><span class="n">csr_matrix</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="k">import</span> <span class="n">eigsh</span>
<span class="kn">from</span> <span class="nn">scipy.special.specfun</span> <span class="k">import</span> <span class="n">fcoef</span>
<span class="c1">#from scipy.integrate import ode</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">alkali_atom_functions</span> <span class="k">import</span> <span class="n">printStateString</span><span class="p">,</span> <span class="n">_EFieldCoupling</span><span class="p">,</span> <span class="n">printStateLetter</span><span class="p">,</span><span class="n">printStateStringLatex</span>

<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<div class="viewcode-block" id="StarkMap"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap">[docs]</a><span class="k">class</span> <span class="nc">StarkMap</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates Stark maps for single atom in a field</span>
<span class="sd">        </span>
<span class="sd">        This initializes calculation for the atom of a given type. For details </span>
<span class="sd">        of calculation see Zimmerman [1]_. For a quick working example</span>
<span class="sd">        see `Stark map example snippet`_.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">            atom (:obj:`AlkaliAtom`): ={ :obj:`alkali_atom_data.Lithium6`, </span>
<span class="sd">                :obj:`alkali_atom_data.Lithium6`,</span>
<span class="sd">                :obj:`alkali_atom_data.Sodium`,</span>
<span class="sd">                :obj:`alkali_atom_data.Potassium`,</span>
<span class="sd">                :obj:`alkali_atom_data.Rubidium`,</span>
<span class="sd">                :obj:`alkali_atom_data.Caesium` } </span>
<span class="sd">                Select the alkali metal for energy level </span>
<span class="sd">                diagram calculation</span>
<span class="sd">            </span>


<span class="sd">        Examples:</span>
<span class="sd">            State :math:`28~S_{1/2}~|m_j|=0.5` polarizability calculation</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from arc import *</span>
<span class="sd">            &gt;&gt;&gt; calc = StarkMap(Caesium())</span>
<span class="sd">            &gt;&gt;&gt; calc.defineBasis(28, 0, 0.5, 0.5, 23, 32, 20)</span>
<span class="sd">            &gt;&gt;&gt; calc.diagonalise(np.linspace(00.,6000,600))</span>
<span class="sd">            &gt;&gt;&gt; print &quot;%.5f MHz cm^2 / V^2 &quot; % calc.getPolarizability()</span>
<span class="sd">            0.76705 MHz cm^2 / V^2 </span>
<span class="sd">            </span>
<span class="sd">            Stark map calculation</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from arc import *</span>
<span class="sd">            &gt;&gt;&gt; calc = StarkMap(Caesium())</span>
<span class="sd">            &gt;&gt;&gt; calc.defineBasis(28, 0, 0.5, 0.5, 23, 32, 20)</span>
<span class="sd">            &gt;&gt;&gt; calc.diagonalise(np.linspace(00.,60000,600))</span>
<span class="sd">            &gt;&gt;&gt; calc.plotLevelDiagram()</span>
<span class="sd">            &gt;&gt;&gt; calc.showPlot()</span>
<span class="sd">            &lt;&lt; matplotlib plot will open containing a Stark map &gt;&gt;</span>
<span class="sd">            </span>
<span class="sd">        References:</span>
<span class="sd">            .. [1] M. L. Zimmerman et.al, PRA **20**:2251 (1979)</span>
<span class="sd">                https://doi.org/10.1103/PhysRevA.20.2251</span>
<span class="sd">        </span>
<span class="sd">        .. _`Stark map example snippet`:</span>
<span class="sd">            ./Rydberg_atoms_a_primer.html#Rydberg-Atom-Stark-Shifts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atom</span><span class="p">):</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="p">[]</span>
        
        
        <span class="c1"># finding energy levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves electric field (in units of V/m) for which energy levels are calculated </span>
<span class="sd">        </span>
<span class="sd">        See also:</span>
<span class="sd">            :obj:`y`, :obj:`highlight`, :obj:`diagonalise`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># eigenValues</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `y[i]` is an array of eigenValues corresponding to the energies of the</span>
<span class="sd">        atom states at the electric field `eFieldList[i]`. For example `y[i][j]` is</span>
<span class="sd">        energy of the `j` eigenvalue (energy of the state) measured in </span>
<span class="sd">        cm :math:`{}^{-1}` relative to the ionization threshold.</span>
<span class="sd">        </span>
<span class="sd">        See also:</span>
<span class="sd">            :obj:`eFieldList`, :obj:`highlight`, :obj:`diagonalise`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#contribution of initial state there (overlap |&lt;original state | given state&gt;|^2)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `highlight[i]` is an array of values measuring highlighted feature in the </span>
<span class="sd">        eigenstates at electric field intensity `eFieldList[i]`. E.g. `highlight[i][j]`</span>
<span class="sd">        measures highlighted feature of the state with energy `y[i][j]` at electric</span>
<span class="sd">        field `eFieldList[i]`. What will be highlighted feature is defined in the</span>
<span class="sd">        call of :obj:`diagonalise` (see that part of documentation for details).</span>
<span class="sd">        </span>
<span class="sd">        See also:</span>
<span class="sd">            :obj:`eFieldList`, :obj:`y`, :obj:`diagonalise`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># pointers towards figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># values used for fitting polarizability, and fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitX</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitY</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittedCurveY</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span> <span class="o">=</span> <span class="mf">0.</span>
        
        <span class="c1"># STARK memoization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eFieldCouplingSaved</span> <span class="o">=</span> <span class="n">_EFieldCoupling</span><span class="p">()</span>
        
        
    
    <span class="k">def</span> <span class="nf">_eFieldCouplingDivE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">):</span>
        <span class="c1"># eFied coupling devided with E (witout actuall multiplication to getE)</span>
        <span class="c1"># delta(mj1,mj2&#39;) delta(l1,l2+-1)</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mj1</span><span class="o">-</span><span class="n">mj2</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">l1</span><span class="o">-</span><span class="n">l2</span><span class="p">)</span> <span class="o">!=</span><span class="mi">1</span><span class="p">)</span> <span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="c1"># matrix element</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getRadialMatrixElement</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">)</span><span class="o">*</span>\
                <span class="n">physical_constants</span><span class="p">[</span><span class="s2">&quot;Bohr radius&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">elemCharge</span>

        <span class="n">sumPart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eFieldCouplingSaved</span><span class="o">.</span><span class="n">getAngular</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span><span class="o">*</span><span class="n">sumPart</span>
    
    <span class="k">def</span> <span class="nf">_eFieldCoupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">,</span><span class="n">eField</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eFieldCouplingDivE</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">mj2</span><span class="p">)</span><span class="o">*</span><span class="n">eField</span>
    
    
<div class="viewcode-block" id="StarkMap.defineBasis"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap.defineBasis">[docs]</a>    <span class="k">def</span> <span class="nf">defineBasis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">mj</span><span class="p">,</span><span class="n">nMin</span><span class="p">,</span><span class="n">nMax</span><span class="p">,</span><span class="n">maxL</span><span class="p">,</span><span class="n">progressOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>\
                    <span class="n">debugOutput</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initializes basis of states around state of interest</span>
<span class="sd">            </span>
<span class="sd">            Defines basis of states for further calculation. :math:`n,l,j,m_j` </span>
<span class="sd">            specify state whose neighbourhood and polarizability we want</span>
<span class="sd">            to explore. Other parameters specify basis of calculations.</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                n (int): principal quantum number of the state</span>
<span class="sd">                l (int): angular orbital momentum of the state</span>
<span class="sd">                j (flaot): total angular momentum of the state</span>
<span class="sd">                mj (float): projection of total angular momentum of the state</span>
<span class="sd">                nMin (int): *minimal* principal quantum number of the states to </span>
<span class="sd">                    be included in the basis for calculation</span>
<span class="sd">                nMax (int): *maximal* principal quantum number of the states to </span>
<span class="sd">                    be included in the basis for calculation</span>
<span class="sd">                maxL (int): *maximal* value of orbital angular momentum for the </span>
<span class="sd">                    states to be included in the basis for calculation</span>
<span class="sd">                progressOutput (:obj:`bool`, optional): if True prints the </span>
<span class="sd">                    progress of calculation; Set to false by default.</span>
<span class="sd">                debugOutput (:obj:`bool`, optional): if True prints additional </span>
<span class="sd">                    information usefull for debuging. Set to false by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">wignerPrecal</span>
        <span class="n">wignerPrecal</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># save calculation details START</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span><span class="n">l</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="o">=</span><span class="n">j</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mj</span> <span class="o">=</span> <span class="n">mj</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMin</span> <span class="o">=</span> <span class="n">nMin</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMax</span> <span class="o">=</span> <span class="n">nMax</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxL</span> <span class="o">=</span> <span class="n">maxL</span>
        <span class="c1"># save calculation details END</span>


        <span class="k">for</span> <span class="n">tn</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nMin</span><span class="p">,</span><span class="n">nMax</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">tl</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">maxL</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">tn</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mj</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">):</span> 
                    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tn</span><span class="p">,</span><span class="n">tl</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj</span><span class="p">])</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">tl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mj</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">):</span>
                    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tn</span><span class="p">,</span><span class="n">tl</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">tl</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mj</span><span class="p">])</span>

        <span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Found &quot;</span><span class="p">,</span><span class="n">dimension</span><span class="p">,</span><span class="s2">&quot; states.&quot;</span> 
            <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
                <span class="nb">print</span> <span class="n">states</span>
        
        <span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span>\
                 <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">mj</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="n">index</span>
            <span class="n">index</span> <span class="o">+=</span><span class="mi">1</span> 
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Index of initial state&quot;</span>
            <span class="nb">print</span> <span class="n">indexOfCoupledState</span>
            <span class="nb">print</span> <span class="s2">&quot;Initial state = &quot;</span>
            <span class="nb">print</span> <span class="n">states</span><span class="p">[</span><span class="n">indexOfCoupledState</span><span class="p">]</span>
        
        
        <span class="n">mat1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">mat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimension</span><span class="p">,</span><span class="n">dimension</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span> <span class="o">=</span> <span class="n">states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="n">indexOfCoupledState</span>
        
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Generating matrix...&quot;</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">+=</span> <span class="p">((</span><span class="n">dimension</span><span class="o">-</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">%d%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dimension</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># add diagonal element</span>
            <span class="n">mat1</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                               <span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>\
                            <span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span>
            <span class="c1"># add off-diagonal element</span>

            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eFieldCouplingDivE</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>\
                                                    <span class="p">,</span><span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>\
                                                    <span class="n">states</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">mj</span><span class="p">,</span>\
                                                    <span class="n">states</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                                    <span class="n">states</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>\
                                                    <span class="n">states</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">mj</span><span class="p">)</span><span class="o">*</span>\
                            <span class="mf">1.e-9</span><span class="o">/</span><span class="n">h</span>
                <span class="n">mat2</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupling</span>
                <span class="n">mat2</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupling</span>
         
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">mat1</span><span class="o">+</span><span class="n">mat2</span>
            <span class="nb">print</span> <span class="n">mat2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">mat1</span> <span class="o">=</span> <span class="n">mat1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat2</span> <span class="o">=</span> <span class="n">mat2</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">updateDipoleMatrixElementsFile</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>
        <span class="n">wignerPrecal</span> <span class="o">=</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="StarkMap.diagonalise"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap.diagonalise">[docs]</a>    <span class="k">def</span> <span class="nf">diagonalise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">eFieldList</span><span class="p">,</span><span class="n">drivingFromState</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">progressOutput</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">debugOutput</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Finds atom eigenstates in a given electric field</span>
<span class="sd">            </span>
<span class="sd">            Eigenstates are calculated for a list of given electric fields. To </span>
<span class="sd">            extract polarizability of the originaly stated state see </span>
<span class="sd">            :obj:`getPolarizability` method. Results are saved in </span>
<span class="sd">            :obj:`eFieldList`, :obj:`y` and :obj:`highlight`.</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                eFieldList (array): array of electric field strength (in V/m)</span>
<span class="sd">                    for which we want to know energy eigenstates</span>

<span class="sd">                progressOutput (:obj:`bool`, optional): if True prints the </span>
<span class="sd">                    progress of calculation; Set to false by default.</span>
<span class="sd">                debugOutput (:obj:`bool`, optional): if True prints additional </span>
<span class="sd">                    information usefull for debuging. Set to false by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># if we are driving from some state</span>
        <span class="c1"># ========= FIND LASER COUPLINGS (START) =======</span>
        
        <span class="n">coupling</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span> <span class="o">=</span> <span class="n">drivingFromState</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span> <span class="nb">print</span> <span class="s2">&quot;Finding coupling strengths&quot;</span>
            <span class="c1"># get first what was the state we are calculating coupling with</span>
            <span class="n">state1</span> <span class="o">=</span> <span class="n">drivingFromState</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">j1</span> <span class="o">=</span> <span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">state1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">state1</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">thisCoupling</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="c1">#if progressOutput:</span>
                <span class="c1">#    sys.stdout.write(&quot;\r%d%%&quot; %  (i/float(dimension)*100.))</span>
                <span class="c1">#    sys.stdout.flush()</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">l1</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="ow">and</span>\
                    <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">j1</span><span class="p">))</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>\
                    <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">m1</span><span class="o">-</span><span class="n">q</span><span class="p">))</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="n">state2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">j2</span> <span class="o">=</span> <span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">m2</span> <span class="o">=</span> <span class="n">state2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
                        <span class="nb">print</span> <span class="n">n1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="s2">&quot; &lt; - &quot;</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s2">&quot; - &gt;&quot;</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span>\
                            <span class="n">l2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="c1">#print self.basisStates[i]</span>
                    <span class="n">dme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getDipoleMatrixElement</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span>\
                                                            <span class="n">n2</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">j2</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span>\
                                                            <span class="n">q</span><span class="p">)</span>
                    <span class="n">thisCoupling</span> <span class="o">+=</span> <span class="n">dme</span>
                <span class="n">thisCoupling</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">thisCoupling</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                <span class="k">if</span> <span class="n">thisCoupling</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span> <span class="o">=</span> <span class="n">thisCoupling</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">thisCoupling</span> <span class="o">&gt;</span><span class="mf">0.00000001</span><span class="p">)</span> <span class="ow">and</span> <span class="n">debugOutput</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;coupling = &quot;</span><span class="p">,</span><span class="n">thisCoupling</span>       
                <span class="n">coupling</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisCoupling</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span><span class="o">&lt;</span><span class="mf">0.00000001</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;State that you specified in drivingFromState, for a &quot;</span><span class="o">+</span>\
                <span class="s2">&quot;given laser polarization, is uncoupled from the specified Stark &quot;</span><span class="o">+</span>\
                <span class="s2">&quot;manifold. If you just want to see the specified Stark manifold &quot;</span><span class="o">+</span>\
                <span class="s2">&quot;remove driveFromState optional argument from call of function &quot;</span><span class="o">+</span>\
                <span class="s2">&quot;diagonalise. Or specify state and driving that is coupled &quot;</span><span class="o">+</span>\
                <span class="s2">&quot;to a given manifold to see coupling strengths.&quot;</span><span class="p">)</span>
        
        <span class="c1"># ========= FIND LASER COUPLINGS (END) =======</span>
        
        
        <span class="n">mat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat1</span>
        <span class="n">mat2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat2</span>
        <span class="n">indexOfCoupledState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span> <span class="o">=</span> <span class="n">eFieldList</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">composition</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Finding eigenvectors...&quot;</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">eField</span> <span class="ow">in</span> <span class="n">eFieldList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">+=</span> <span class="mf">1.</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">%d%%</span><span class="s2">&quot;</span> <span class="o">%</span> \
                                 <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            
            <span class="n">m</span> <span class="o">=</span> <span class="n">mat1</span><span class="o">+</span><span class="n">mat2</span><span class="o">*</span><span class="n">eField</span>
 
            <span class="n">ev</span><span class="p">,</span><span class="n">egvector</span> <span class="o">=</span> <span class="n">eigh</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                <span class="n">sh</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">)):</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">egvector</span><span class="p">[</span><span class="n">indexOfCoupledState</span><span class="p">,</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stateComposition2</span><span class="p">(</span><span class="n">egvector</span><span class="p">[:,</span><span class="n">i</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sh</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">)):</span>
                    <span class="n">sumCoupledStates</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                        <span class="n">sumCoupledStates</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coupling</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">maxCoupling</span><span class="p">)</span><span class="o">*</span>\
                                                <span class="nb">abs</span><span class="p">(</span><span class="n">egvector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stateComposition2</span><span class="p">(</span><span class="n">egvector</span><span class="p">[:,</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sumCoupledStates</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
            

        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> </div>

<div class="viewcode-block" id="StarkMap.exportData"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap.exportData">[docs]</a>    <span class="k">def</span> <span class="nf">exportData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fileBase</span><span class="p">,</span><span class="n">exportFormat</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Exports StarkMap calculation data.</span>
<span class="sd">            </span>
<span class="sd">            Only supported format (selected by default) is .csv in a </span>
<span class="sd">            human-readable form with a header that saves details of calculation. </span>
<span class="sd">            Function saves three files: 1) `filebase` _eField.csv; </span>
<span class="sd">            2) `filebase` _energyLevels</span>
<span class="sd">            3) `filebase` _highlight</span>
<span class="sd">           </span>
<span class="sd">            For more details on the format, see header of the saved files.</span>
<span class="sd">           </span>
<span class="sd">            Args:</span>
<span class="sd">                filebase (string): filebase for the names of the saved files</span>
<span class="sd">                    without format extension. Add as a prefix a directory path</span>
<span class="sd">                    if necessary (e.g. saving outside the current working directory)</span>
<span class="sd">                exportFormat (string): optional. Format of the exported file. Currently</span>
<span class="sd">                    only .csv is supported but this can be extended in the future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;on %Y-%m-</span><span class="si">%d</span><span class="s1"> @ %H:%M:%S&#39;</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        
        <span class="n">commonHeader</span> <span class="o">=</span> <span class="s2">&quot;Export from Alkali Rydberg Calculator (ARC) </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ts</span>
        <span class="n">commonHeader</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> *** Stark Map for </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> m_j = </span><span class="si">%d</span><span class="s2">/2. ***</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">elementName</span><span class="p">,</span>
                        <span class="n">printStateString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mj</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">commonHeader</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot; - Included states - principal quantum number (n) range [</span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">].</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>\
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMax</span><span class="p">))</span>
        <span class="n">commonHeader</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot; - Included states with orbital momentum (l) in range [</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">] (i.e. </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span>\
                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxL</span><span class="p">,</span> <span class="n">printStateLetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">printStateLetter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxL</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">:</span>
            <span class="n">commonHeader</span> <span class="o">+=</span> <span class="s2">&quot; - State highlighting based on the relative contribution </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
            <span class="s2">&quot;   of the original state in the eigenstates obtained by diagonalization.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">commonHeader</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot; - State highlighting based on the relative driving strength </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
            <span class="s2">&quot;   to a given energy eigenstate (energy level) from state</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
            <span class="s2">&quot;   </span><span class="si">%s</span><span class="s2"> m_j =</span><span class="si">%d</span><span class="s2">/2 with polarization q=</span><span class="si">%d</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span>\
             <span class="p">(</span> <span class="n">printStateString</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]),</span>\
             <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">3</span><span class="p">])),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        
        
        <span class="k">if</span> <span class="n">exportFormat</span><span class="o">==</span><span class="s2">&quot;csv&quot;</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Exporting StarkMap calculation results as .csv ...&quot;</span>
            
            <span class="n">commonHeader</span> <span class="o">+=</span> <span class="s2">&quot; - Export consists of three (3) files:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">commonHeader</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;       1) </span><span class="si">%s</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileBase</span><span class="o">+</span><span class="s2">&quot;_eField.&quot;</span><span class="o">+</span><span class="n">exportFormat</span><span class="p">))</span>
            <span class="n">commonHeader</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;       2) </span><span class="si">%s</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileBase</span><span class="o">+</span><span class="s2">&quot;_energyLevels.&quot;</span><span class="o">+</span><span class="n">exportFormat</span><span class="p">))</span>
            <span class="n">commonHeader</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;       3) </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileBase</span><span class="o">+</span><span class="s2">&quot;_highlight.&quot;</span><span class="o">+</span><span class="n">exportFormat</span><span class="p">))</span>
            
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fileBase</span><span class="o">+</span><span class="s2">&quot;_eField.&quot;</span><span class="o">+</span><span class="n">exportFormat</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.18e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span>\
                <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> \
                <span class="n">header</span><span class="o">=</span><span class="p">(</span><span class="n">commonHeader</span> <span class="o">+</span> <span class="s2">&quot; - - - eField (V/m) - - -&quot;</span><span class="p">),</span>\
                <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s2">&quot;   Electric field values (V/m) saved in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span> 
            
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fileBase</span><span class="o">+</span><span class="s2">&quot;_energyLevels.&quot;</span><span class="o">+</span><span class="n">exportFormat</span>
            <span class="n">headerDetails</span> <span class="o">=</span> <span class="s2">&quot; NOTE : Each row corresponds to eigenstates for a single specified electric field&quot;</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.18e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span>\
                <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> \
                <span class="n">header</span><span class="o">=</span><span class="p">(</span><span class="n">commonHeader</span> <span class="o">+</span> <span class="s1">&#39; - - - Energy (GHz) - - -</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">headerDetails</span><span class="p">),</span>\
                <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s2">&quot;   Lists of energies (in GHz relative to ionisation) saved in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span>
            
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fileBase</span><span class="o">+</span><span class="s2">&quot;_highlight.&quot;</span><span class="o">+</span><span class="n">exportFormat</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.18e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span>\
                <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> \
                <span class="n">header</span><span class="o">=</span><span class="p">(</span><span class="n">commonHeader</span> <span class="o">+</span> <span class="s1">&#39; - - - Highlight value (rel.units) - - -</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span> <span class="n">headerDetails</span><span class="p">),</span>\
                <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s2">&quot;   Highlight values saved in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span>
            
            <span class="nb">print</span> <span class="s2">&quot;... data export finished!&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported export format (.</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="StarkMap.plotLevelDiagram"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap.plotLevelDiagram">[docs]</a>    <span class="k">def</span> <span class="nf">plotLevelDiagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">highlighState</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">progressOutput</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                        <span class="n">debugOutput</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">highlightColour</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">):</span>    
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Makes a plot of a stark map of energy levels</span>
<span class="sd">            </span>
<span class="sd">            To save this plot, see :obj:`savePlot`. To print this plot see </span>
<span class="sd">            :obj:`showPlot`.</span>

<span class="sd">            Args:</span>
<span class="sd">                units (:obj:`int`,optional): possible values {1,2} ; if the </span>
<span class="sd">                    value is 1 (default) Stark diagram will be plotted in </span>
<span class="sd">                    energy units cm :math:`{}^{-1}`; if value is 2, Stark </span>
<span class="sd">                    diagram will be plotted as energy :math:`/h` in units of GHz</span>
<span class="sd">                highlightState (:obj:`bool`, optional): False by default. If </span>
<span class="sd">                    True, scatter plot colour map will map in red amount of </span>
<span class="sd">                    original state for the given eigenState</span>
<span class="sd">                progressOutput (:obj:`bool`, optional): if True prints the </span>
<span class="sd">                    progress of calculation; Set to False by default.</span>
<span class="sd">                debugOutput (:obj:`bool`, optional): if True prints additional </span>
<span class="sd">                    information usefull for debuging. Set to False by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rvb</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;mymap&#39;</span><span class="p">,</span>\
                                               <span class="p">[</span><span class="s1">&#39;0.9&#39;</span><span class="p">,</span> <span class="n">highlightColour</span><span class="p">,</span><span class="s1">&#39;black&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
        
        <span class="k">if</span> <span class="n">progressOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;plotting...&quot;</span>
        
        <span class="c1">#eFieldList = self.eFieldList</span>
        <span class="c1">#y = self.y</span>
        <span class="c1">#highlight = self.highlight</span>

        <span class="n">originalState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="n">existingPlot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">11.</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">existingPlot</span> <span class="o">=</span> <span class="kc">True</span>

        
        <span class="n">eFieldList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span><span class="p">[]</span> 
        <span class="n">yState</span> <span class="o">=</span> <span class="p">[]</span>
        
        
        <span class="k">for</span> <span class="n">br</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)):</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br</span><span class="p">])):</span>
                <span class="c1">#if self.highlight[br][i]&gt;0.02:</span>
                <span class="n">eFieldList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">br</span><span class="p">])</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">yState</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">[</span><span class="n">br</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="c1">#print self.highlight[br][i]</span>
                <span class="c1">#else:</span>
                <span class="c1">#    grayX.append(self.x[i])</span>
                <span class="c1">#    grayY.append(self.y[br][i])</span>
                <span class="c1">#    grayColour.append(self.highlight[br][i])</span>
        
        <span class="n">yState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yState</span><span class="p">)</span>
        <span class="n">sortOrder</span> <span class="o">=</span> <span class="n">yState</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;heapsort&#39;</span><span class="p">)</span>
        <span class="n">eFieldList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        
        <span class="n">eFieldList</span> <span class="o">=</span> <span class="n">eFieldList</span><span class="p">[</span><span class="n">sortOrder</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">sortOrder</span><span class="p">]</span>
        <span class="n">yState</span> <span class="o">=</span> <span class="n">yState</span><span class="p">[</span><span class="n">sortOrder</span><span class="p">]</span>

        
        <span class="k">if</span> <span class="p">(</span><span class="n">units</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1">## in cm^-1</span>


            <span class="k">if</span> <span class="ow">not</span> <span class="n">highlighState</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">eFieldList</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span><span class="n">y</span><span class="o">*</span><span class="mf">0.03336</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cm</span> <span class="o">=</span> <span class="n">rvb</span><span class="c1">#plt.get_cmap(&#39;coolwarm&#39;) </span>
                <span class="n">cNorm</span>  <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">eFieldList</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span><span class="n">y</span><span class="o">*</span><span class="mf">0.03336</span><span class="p">,</span>\
                                <span class="n">c</span><span class="o">=</span><span class="n">yState</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">existingPlot</span><span class="p">:</span>
                    <span class="n">cax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.91</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">r&quot;$|\langle </span><span class="si">%s</span><span class="s2"> | \mu \rangle |^2$&quot;</span> <span class="o">%</span> \
                                 <span class="n">printStateStringLatex</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">r&quot;$( \Omega_\mu | \Omega )^2$&quot;</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## in GHz</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">highlighState</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">eFieldList</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span><span class="n">y</span><span class="p">,</span>\
                                <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># in GHz  </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cm</span> <span class="o">=</span> <span class="n">rvb</span><span class="c1"># plt.get_cmap(&#39;coolwarm&#39;) </span>
                <span class="n">cNorm</span>  <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">eFieldList</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">yState</span><span class="p">,</span>\
                                <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">existingPlot</span><span class="p">:</span>
                    <span class="n">cax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.91</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> \
                                                          <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">r&quot;$|\langle </span><span class="si">%s</span><span class="s2"> | \mu \rangle |^2$&quot;</span> <span class="o">%</span>\
                                  <span class="n">printStateStringLatex</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">r&quot;$(\Omega_\mu / \Omega )^2$&quot;</span><span class="p">)</span>
 
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Electric field (V/cm)&quot;</span><span class="p">)</span>

        
        <span class="k">if</span> <span class="p">(</span><span class="n">units</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1">## in cm^{-1}</span>
            <span class="n">uppery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="mf">0.03336</span><span class="o">+</span><span class="mi">10</span>
            <span class="n">lowery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="mf">0.03336</span><span class="o">-</span><span class="mi">10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;State energy, $E/(h c)$ (cm$^{-1}$)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## in GHz</span>
            <span class="n">uppery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span><span class="o">+</span><span class="mi">5</span>
            <span class="n">lowery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">r&quot;State energy, $E/h$ (GHz)&quot;</span><span class="p">)</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lowery</span><span class="p">,</span><span class="n">uppery</span><span class="p">)</span>
        <span class="c1">##</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="StarkMap.savePlot"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap.savePlot">[docs]</a>    <span class="k">def</span> <span class="nf">savePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;StarkMap.pdf&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Saves plot made by :obj:`plotLevelDiagram`</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                filename (:obj:`str`, optional): file location where the plot </span>
<span class="sd">                    should be saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Error while saving a plot: nothing is plotted yet&quot;</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="StarkMap.showPlot"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap.showPlot">[docs]</a>    <span class="k">def</span> <span class="nf">showPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interactive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Shows plot made by :obj:`plotLevelDiagram`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Click on state to see state composition&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clickedPoint</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onPick</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Error while showing a plot: nothing is plotted yet&quot;</span>
        <span class="k">return</span> <span class="mi">0</span></div>
    
    <span class="k">def</span> <span class="nf">_onPick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PathCollection</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">scaleFactor</span> <span class="o">=</span> <span class="mf">0.03336</span>
            
            <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">xdata</span><span class="o">*</span><span class="mf">100.</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">ydata</span><span class="o">/</span><span class="n">scaleFactor</span>
            
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">))):</span>
                <span class="n">i</span> <span class="o">-=</span><span class="mi">1</span>
            
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">)):</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">jj</span>
            
            <span class="c1"># now choose the most higlighted state in this area        </span>
            <span class="n">distance</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mf">1.5</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">distance</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]))):</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">jj</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickedPoint</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clickedPoint</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">clickedPoint</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span><span class="p">],</span>\
                                               <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">scaleFactor</span><span class="p">],</span><span class="s2">&quot;bs&quot;</span><span class="p">,</span>\
                                                 <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">((</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] = &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">elementName</span><span class="p">)</span><span class="o">+</span>\
                              <span class="bp">self</span><span class="o">.</span><span class="n">_stateComposition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">composition</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">+</span>\
                             <span class="p">(</span><span class="s2">&quot;   Colourbar value = </span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span>
                             <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">_stateComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stateVector</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">totalContribution</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">stateVector</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">totalContribution</span><span class="o">&lt;</span><span class="mf">0.95</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">stateVector</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">value</span><span class="o">+=</span> <span class="s2">&quot;+&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">+</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stateVector</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addState</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="n">stateVector</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">totalContribution</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">stateVector</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="k">if</span> <span class="n">totalContribution</span><span class="o">&lt;</span><span class="mf">0.999</span><span class="p">:</span>
            <span class="n">value</span><span class="o">+=</span><span class="s2">&quot;+</span><span class="se">\\</span><span class="s2">ldots&quot;</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">+</span><span class="s2">&quot;$&quot;</span>
    

    <span class="k">def</span> <span class="nf">_stateComposition2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stateVector</span><span class="p">,</span><span class="n">upTo</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">contribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">stateVector</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">contribution</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;heapsort&#39;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">totalContribution</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mainStates</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">#[state Value, state index] </span>
        <span class="k">while</span> <span class="p">(</span><span class="n">index</span><span class="o">&gt;-</span><span class="n">upTo</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">totalContribution</span><span class="o">&lt;</span><span class="mf">0.95</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">mainStates</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stateVector</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">])</span>
            <span class="n">totalContribution</span> <span class="o">+=</span> <span class="n">contribution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">mainStates</span>    

    <span class="k">def</span> <span class="nf">_addState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">mj1</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;|</span><span class="si">%s</span><span class="s2"> m_j=</span><span class="si">%d</span><span class="s2">/2</span><span class="se">\\</span><span class="s2">rangle&quot;</span> <span class="o">%</span>\
             <span class="p">(</span><span class="n">printStateStringLatex</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">j1</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mj1</span><span class="p">))</span>
             
<div class="viewcode-block" id="StarkMap.getPolarizability"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.StarkMap.getPolarizability">[docs]</a>    <span class="k">def</span> <span class="nf">getPolarizability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxField</span><span class="o">=</span><span class="mf">1.e10</span><span class="p">,</span> <span class="n">showPlot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>\
                           <span class="n">debugOutput</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">minStateContribution</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns the polarizability of the state (set during the </span>
<span class="sd">            initalization process)</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                maxField (:obj:`float`, optional): maximum field (in V/m) to be </span>
<span class="sd">                    used for fitting the polarizability. By default, max field </span>
<span class="sd">                    is very large, so it will use eigenvalues calculated in the </span>
<span class="sd">                    whole range. </span>
<span class="sd">                showPlot (:obj:`bool`, optional): shows plot of calculated </span>
<span class="sd">                    eigenValues of the given state (dots), and the fit (solid </span>
<span class="sd">                    line) for extracting polarizability</span>
<span class="sd">                debugOutput (:obj:`bool`, optional): if True prints additional </span>
<span class="sd">                    information usefull for debuging. Set to false by default.</span>
<span class="sd">                </span>
<span class="sd">                </span>
<span class="sd">            Returns:</span>
<span class="sd">                float: scalar polarizability in units of MHz cm :math:`^2` / V \</span>
<span class="sd">                :math:`^2` </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivingFromState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Program can only find Polarizability of the original &quot;</span><span class="o">+</span>\
            <span class="s2">&quot;state if you highlight original state. You can do so by NOT &quot;</span><span class="o">+</span>\
            <span class="s2">&quot;specifying drivingFromState in diagonalise function.&quot;</span><span class="p">)</span>
            
          
        <span class="n">eFieldList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eFieldList</span>
        <span class="n">yState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

        <span class="n">originalState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basisStates</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexOfCoupledState</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">originalState</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">energyOfOriginalState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">elemCharge</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span> <span class="c1"># in  GHz</span>

        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;finding original state for each electric field value&quot;</span>
            
        <span class="n">stopFitIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">stopFitIndex</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> \
            <span class="n">eFieldList</span><span class="p">[</span><span class="n">stopFitIndex</span><span class="p">]</span><span class="o">&lt;</span><span class="n">maxField</span><span class="p">:</span>
            <span class="n">stopFitIndex</span> <span class="o">+=</span> <span class="mi">1</span> 
            
        <span class="n">xOriginalState</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">yOriginalState</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">stopFitIndex</span><span class="p">):</span>
            
            <span class="n">maxPortion</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">yval</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">jj</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">yState</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="o">&gt;</span><span class="n">maxPortion</span><span class="p">:</span>
                    <span class="n">maxPortion</span> <span class="o">=</span> <span class="n">yState</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span>
                    <span class="n">yval</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span>
            <span class="c1"># measure state energy relative to the original state</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">minStateContribution</span><span class="o">&lt;</span><span class="n">maxPortion</span><span class="p">):</span>
                <span class="n">xOriginalState</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eFieldList</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">yOriginalState</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yval</span><span class="o">-</span><span class="n">energyOfOriginalState</span><span class="p">)</span> 


        <span class="n">xOriginalState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span> <span class="c1"># converts to V/cm</span>
        <span class="n">yOriginalState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yOriginalState</span><span class="p">)</span>   <span class="c1"># in GHz</span>
        
        
        <span class="c1">## in GHz</span>
        <span class="n">uppery</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="n">lowery</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>

        
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;found &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">)</span>     
        <span class="k">if</span> <span class="n">showPlot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">,</span><span class="n">yOriginalState</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>  
        
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;E field (V/cm)&quot;</span><span class="p">)</span>
    
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lowery</span><span class="p">,</span><span class="n">uppery</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">r&quot;Energy/$h$ (GHz)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
                                <span class="n">xOriginalState</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        
        <span class="k">def</span> <span class="nf">polarizabilityFit</span><span class="p">(</span><span class="n">eField</span><span class="p">,</span><span class="n">offset</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">offset</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">eField</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">polarizabilityFit</span><span class="p">,</span>\
                              <span class="n">xOriginalState</span><span class="p">,</span>\
                              <span class="n">yOriginalState</span><span class="p">,</span>\
                              <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: fitting energy levels for extracting polarizability</span><span class="se">\</span>
<span class="s2">                    of the state failed. Please check the range of electric </span><span class="se">\</span>
<span class="s2">                    fields where you are trying to fit polarizability and ensure</span><span class="se">\</span>
<span class="s2">                    that there is only one state with continuous energy change</span><span class="se">\</span>
<span class="s2">                    that has dominant contribution of the initial state.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="n">debugOutput</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Scalar polarizability = &quot;</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e3</span><span class="p">,</span><span class="s2">&quot; MHz cm^2 / V^2 &quot;</span>
          
        <span class="n">y_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">xOriginalState</span><span class="p">:</span>
            <span class="n">y_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polarizabilityFit</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">y_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_fit</span><span class="p">)</span>
          
        <span class="k">if</span> <span class="n">showPlot</span><span class="p">:</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xOriginalState</span><span class="p">,</span><span class="n">y_fit</span><span class="p">,</span><span class="s2">&quot;r--&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;fitted model function&quot;</span><span class="p">,</span><span class="s2">&quot;calculated energy level&quot;</span><span class="p">),</span>\
                      <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">yOriginalState</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">yOriginalState</span><span class="p">))</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">fitX</span> <span class="o">=</span> <span class="n">xOriginalState</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitY</span> <span class="o">=</span> <span class="n">yOriginalState</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittedCurveY</span> <span class="o">=</span> <span class="n">y_fit</span>
        
        <span class="k">return</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e3</span> <span class="c1"># returned value is in  MHz cm^2 / V^2 </span></div></div>
    


<span class="c1"># ================= Level plots, decays, cascades etc =======================</span>

<div class="viewcode-block" id="LevelPlot"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.LevelPlot">[docs]</a><span class="k">class</span> <span class="nc">LevelPlot</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Single atom level plots and decays</span>
<span class="sd">        </span>
<span class="sd">        For an example see `Rydberg energy levels example snippet`_.</span>
<span class="sd">        </span>
<span class="sd">        .. _`Rydberg energy levels example snippet`:</span>
<span class="sd">            ./Rydberg_atoms_a_primer.html#Rydberg-Atom-Energy-Levels</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            atom (:obj:`AlkaliAtom`): ={ :obj:`alkali_atom_data.Lithium6`, </span>
<span class="sd">                :obj:`alkali_atom_data.Lithium6`,</span>
<span class="sd">                :obj:`alkali_atom_data.Sodium`,</span>
<span class="sd">                :obj:`alkali_atom_data.Potassium`,</span>
<span class="sd">                :obj:`alkali_atom_data.Rubidium`,</span>
<span class="sd">                :obj:`alkali_atom_data.Caesium` } </span>
<span class="sd">                Alkali atom type whose levels we</span>
<span class="sd">                want to examine</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">atom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">listX</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of l</span>
    <span class="n">listY</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of energies </span>
    <span class="n">levelLabel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">width</span> <span class="o">=</span><span class="mf">0.2</span>
    <span class="n">state1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">state2</span> <span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">transitionMatrix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nFrom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nTo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lFrom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lTo</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">populations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">transitionMatrixWavelength3</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># characterization of the graph</span>
    <span class="n">spectraX</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spectraY</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">spectraLine</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># evolution parameters</span>
    <span class="n">cooperativity</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atomType</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atomType</span>
    
    
<div class="viewcode-block" id="LevelPlot.makeLevels"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.LevelPlot.makeLevels">[docs]</a>    <span class="k">def</span> <span class="nf">makeLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nFrom</span><span class="p">,</span><span class="n">nTo</span><span class="p">,</span><span class="n">lFrom</span><span class="p">,</span><span class="n">lTo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructs energy level diagram in a given range </span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                nFrom (int): minimal principal quantum number of the</span>
<span class="sd">                    states we are interested in</span>
<span class="sd">                nTo (int): maximal principal quantum number of the </span>
<span class="sd">                    states we are interested in</span>
<span class="sd">                lFrom (int): minimal orbital angular momentum</span>
<span class="sd">                    of the states we are interested in</span>
<span class="sd">                lTo (int): maximal orbital angular momentum</span>
<span class="sd">                    of the states we are interested in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#save local copy of the space restrictions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nFrom</span> <span class="o">=</span> <span class="n">nFrom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nTo</span> <span class="o">=</span> <span class="n">nTo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lFrom</span> <span class="o">=</span> <span class="n">lFrom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lTo</span> <span class="o">=</span> <span class="n">lTo</span>
        
        <span class="c1"># find all the levels within this space restrictions</span>
        <span class="k">while</span> <span class="n">nFrom</span><span class="o">&lt;=</span><span class="n">nTo</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">lFrom</span>
            <span class="k">while</span> <span class="n">l</span><span class="o">&lt;=</span><span class="nb">min</span><span class="p">(</span><span class="n">lTo</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">nFrom</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">l</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">nFrom</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="mf">0.5</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nFrom</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">nFrom</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nFrom</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="o">+</span><span class="mf">0.5</span><span class="p">])</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">nFrom</span> <span class="o">=</span> <span class="n">nFrom</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">extraLevels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">lTo</span> <span class="ow">and</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">nFrom</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>
            
    <span class="k">def</span> <span class="nf">makeTransitionMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">environmentTemperature</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span><span class="n">printDecays</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span> <span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">)):</span>
            <span class="n">state1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">transitionVector</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># decay of the stay</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="mf">0.0</span>
        
            <span class="k">for</span> <span class="n">state2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">:</span>                
                <span class="n">dipoleAllowed</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="ow">and</span>\
                                <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;=</span><span class="mf">1.01</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dipoleAllowed</span><span class="p">):</span>
                    <span class="c1">#print state1,&quot; &quot;,state2</span>
                    <span class="c1"># decay to thius state</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionRate</span><span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>\
                                                    <span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>\
                                                    <span class="n">temperature</span><span class="o">=</span><span class="n">environmentTemperature</span><span class="p">)</span>
                    
                                       
                    <span class="n">transitionVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
                    
                    <span class="c1"># decay from this state</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionRate</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>\
                                                    <span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>\
                                                    <span class="n">temperature</span><span class="o">=</span><span class="n">environmentTemperature</span><span class="p">)</span>
                    
                    <span class="n">decay</span> <span class="o">=</span> <span class="n">decay</span><span class="o">-</span><span class="n">rate</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">transitionVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    
            <span class="n">transitionVector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">decay</span>
            <span class="k">if</span> <span class="n">printDecays</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Decay time of &quot;</span>
                <span class="n">printState</span><span class="p">(</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">decay</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">20</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> is</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">1.e9</span><span class="o">/</span><span class="n">decay</span><span class="p">,</span><span class="s2">&quot; ns&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transitionVector</span><span class="p">)</span>
        
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transitionMatrix</span><span class="p">)</span>    
        
    <span class="k">def</span> <span class="nf">drawSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">lineWavelength</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lineStrength</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lineName</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="n">j</span><span class="p">):</span>
                    <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionWavelength</span><span class="p">(</span>\
                                     <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                     <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                    <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    
                    <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                     <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>\
                                     <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                     <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                
                    <span class="n">lineWavelength</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span><span class="o">*</span><span class="mf">1.e9</span><span class="p">)</span>
                    <span class="n">lineStrength</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">intensity</span><span class="p">))</span>
                    <span class="n">lineName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printStateString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>\
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span>\
                                        <span class="s2">&quot; -&gt; &quot;</span><span class="o">+</span>
                                        <span class="n">printStateString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>\
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>\
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                    
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>   
        
        <span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">lineWavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">lineStrength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectraLine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">lineName</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">drawSpectraConvoluted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lowerWavelength</span><span class="p">,</span> <span class="n">higherWavelength</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">gamma</span><span class="p">):</span>
        <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">lowerWavelength</span><span class="p">,</span><span class="n">higherWavelength</span><span class="p">,</span><span class="n">points</span><span class="p">)</span>
        <span class="n">spectra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">gamma</span><span class="o">/</span>\
                                <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">spectra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span><span class="n">spectra</span><span class="p">,</span><span class="s2">&quot;g-&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">showSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">saveInFile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">showTransitionPoints</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">showTransitionPoints</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span><span class="p">,</span><span class="s2">&quot;ro&quot;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength (nm)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (arb.un)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="c1">#self.ax.set_xlim(300,600)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onpick3</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">saveInFile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">saveInFile</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
    
<div class="viewcode-block" id="LevelPlot.drawLevels"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.LevelPlot.drawLevels">[docs]</a>    <span class="k">def</span> <span class="nf">drawLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Draws a level diagram plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">))</span>
   
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">],</span> \
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="s2">&quot;b-&quot;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">3</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]],[</span><span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="s2">&quot;ro&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="c1">#alpha=1./(1-log(2.7*self.populations[i])))  </span>
                
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span></div>
        

<div class="viewcode-block" id="LevelPlot.showPlot"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.LevelPlot.showPlot">[docs]</a>    <span class="k">def</span> <span class="nf">showPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Shows a level diagram plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy (eV)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lFrom</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lTo</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># X AXIS</span>
        <span class="n">majorLocator</span>   <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">majorLocator</span><span class="p">)</span>
        <span class="n">tickNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lFrom</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lTo</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">tickNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printStateLetter</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
        <span class="n">tickNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">())</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">tickNames</span><span class="p">)</span>
        <span class="c1">#ax[1].xaxis.set_major_formatter(majorFormatter)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onpick2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">findState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mf">100000000.0</span>
        <span class="n">state</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dist</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">):</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">findStateNo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="c1"># returns no of the given state in the basis</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="ow">and</span>\
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="ow">and</span>\
                <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelLabel</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            
        <span class="nb">print</span> <span class="s2">&quot;Error: requested state &quot;</span>
        <span class="nb">print</span> <span class="n">state</span>
        <span class="nb">print</span> <span class="s2">&quot;could not be found!&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">findLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mf">1.e19</span>
        <span class="n">line</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraLine</span><span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">y</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dist</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">):</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraLine</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">line</span>

    <span class="k">def</span> <span class="nf">onpick2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">):</span>
            <span class="n">thisline</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()</span>

            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findState</span><span class="p">((</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state1</span> <span class="o">=</span> <span class="n">state</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">printStateString</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; -&gt; &quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">printStateString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
                                             <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                                             <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span>\
                            <span class="s2">&quot; -&gt; &quot;</span><span class="o">+</span>\
                            <span class="n">printStateString</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; &quot;</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">+</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%.2f</span><span class="s2"> nm (</span><span class="si">%.3f</span><span class="s2"> GHz)&quot;</span> <span class="o">%</span> \
                                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionWavelength</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>\
                                                                      <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                                                                      <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mi">1</span><span class="n">e9</span><span class="p">,</span>\
                                    <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">getTransitionFrequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>\
                                                                     <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
                                                                     <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                                                                     <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                   
                <span class="bp">self</span><span class="o">.</span><span class="n">state2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onpick3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">Line2D</span><span class="p">):</span>
            <span class="n">thisline</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">thisline</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="nb">print</span> <span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findLine</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ydata</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>


<div class="viewcode-block" id="printState"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.printState">[docs]</a><span class="k">def</span> <span class="nf">printState</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints state spectroscopic label for numeric :math:`n`, </span>
<span class="sd">        :math:`l`, :math:`s` label of the state</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            n (int): principal quantum number</span>
<span class="sd">            l (int): orbital angular momentum</span>
<span class="sd">            j (float): total angular momentum</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="nb">print</span> <span class="n">n</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">printStateLetter</span><span class="p">(</span><span class="n">l</span><span class="p">),(</span><span class="s2">&quot; </span><span class="si">%.0d</span><span class="s2">/2&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span></div>

<div class="viewcode-block" id="printStateString"><a class="viewcode-back" href="../calculations_atoms_single.html#calculations_atom_single.printStateString">[docs]</a><span class="k">def</span> <span class="nf">printStateString</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns state spectroscopic label for numeric :math:`n`, </span>
<span class="sd">        :math:`l`, :math:`s` label of the state</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            n (int): principal quantum number</span>
<span class="sd">            l (int): orbital angular momentum</span>
<span class="sd">            j (float): total angular momentum</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            string: label for the state in standard spectroscopic notation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">printStateLetter</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%.0d</span><span class="s2">/2&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span></div>


<span class="c1"># =============== Atom in E and B FIELDS ==================</span>

<span class="c1">#class AtomInEandBfields():</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Nikola ibali.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.9 beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>